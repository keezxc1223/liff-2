var liffId="2002197923-oyY6wJ68",params=location.search.substring(1),url=window.location.href;if(params)try{params=JSON.parse("{\""+decodeURI(params.replace(/&/g,"\",\"").replace(/=/g,"\":\""))+"\"}")}catch(a){getParameterByName=getParameterByNameV2}window.onload=function(){initVConsole(),initContent(),initLiff(liffId)};var HttpClient=function(){this.get=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c.responseText)},c.open("GET",a,!0),c.send(null)}};function initVConsole(){window.vConsole=new window.VConsole({defaultPlugins:["system","network","element","storage"],maxLogNumber:1e3,onReady:function(){console.log("vConsole is ready.")},onClearLog:function(){}})}function initLiff(a){console.log("Going to initialize LIFF to",a),liff.init({liffId:a}).then(()=>{"liffToken"==getParameterByName("type")&&getLiffToken(),"yes"==getParameterByName("auto")&&getParameterByName("type")&&sendLiffMessage(),initApp()}).catch(a=>{console.error("LIFF initialization failed",a)})}function initApp(){if(console.log("LIFF initialized!"),!liff.isLoggedIn()){var a=document.getElementById("liffSendMessage");a.innerHTML="登入",a.id="liffLogin"}else{if(!liff.isInClient()&&void 0!==getParameterByName("type")){var b=document.getElementById("content"),c=document.createElement("a");c.href="#",c.id="liffLogout",c.className="btn btn-lg btn-danger btn-block",c.innerHTML="登出",b.insertBefore(c,b.childNodes[6])}liff.getProfile().then(a=>{const b=a.displayName;console.info("User name is",b),document.getElementById("greet").innerHTML="你好, "+b+" \u0C7C 感謝你的使用"}).catch(a=>{console.error("LIFF getProfile failed",a)})}registerButtonHandlers()}function registerButtonHandlers(){sendMessageButton=document.getElementById("liffSendMessage"),loginButton=document.getElementById("liffLogin"),logoutButton=document.getElementById("liffLogout"),sendMessageButton&&liff.isInClient()?sendMessageButton.addEventListener("click",sendLiffMessage,!1):sendMessageButton&&!liff.isInClient()?logoutButton.addEventListener("click",logoutLiff,!1):loginButton.addEventListener("click",loginLiff,!1)}function changeType(){var a=document.getElementById("type").value;removeElements("form-label-group"),initContent(a)}function initContent(a){var b=!0,c=document.createElement("div"),d=document.createElement("input"),e=document.createElement("label"),f=document.createElement("textarea");a||(a=getParameterByName("type"),a&&(document.getElementById("type").value=a),0>=document.getElementById("type").selectedIndex&&(document.getElementById("type").value="choose"),b=!1),"yes"==getParameterByName("share")&&(document.getElementById("share").checked=!0),getParameterByName("liffId")&&(liffId=getParameterByName("liffId"));var g=document.getElementById("content");"text"==a?(c.className="form-label-group",c.id="data",d.type="text",d.id="text",d.className="form-control",d.placeholder="Text message",d.required=!0,getParameterByName("text")&&(d.value=getParameterByName("text")),e.htmlFor="text",e.innerHTML="文字訊息",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4])):"sticker"==a||"stickerimage"==a?(c.className="form-label-group",c.id="data",d.type="text",d.id="packageId",d.className="form-control",d.placeholder="Text message",d.required=!0,getParameterByName("packageId")&&(d.value=getParameterByName("packageId")),e.htmlFor="packageId",e.innerHTML="貼圖包編號",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4]),c=document.createElement("div"),d=document.createElement("input"),e=document.createElement("label"),c.className="form-label-group",c.id="data",d.type="text",d.id="stickerId",d.className="form-control",d.placeholder="Preview image url",d.required=!0,getParameterByName("stickerId")&&(d.value=getParameterByName("stickerId")),e.htmlFor="stickerId",e.innerHTML="貼圖編號",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4]),c=document.createElement("div"),checkbox=document.createElement("div"),d=document.createElement("input"),e=document.createElement("label"),checkbox.className="form-label-group",checkbox.id="data",c.className="custom-control custom-checkbox",d.type="checkbox",d.id="animation",d.className="custom-control-input","yes"==getParameterByName("animation")&&(d.checked=!0),e.htmlFor="animation",e.className="custom-control-label",e.innerHTML="動態貼圖",c.appendChild(d),c.appendChild(e),checkbox.appendChild(c),g.insertBefore(checkbox,g.childNodes[4])):"image"==a||"video"==a?(c.className="form-label-group",c.id="data",d.type="text",d.id="downloadUrl",d.className="form-control",d.placeholder="Original content url",d.required=!0,getParameterByName("downloadUrl")&&(d.value=getParameterByName("downloadUrl")),e.htmlFor="downloadUrl",e.innerHTML="下載網址",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4]),c=document.createElement("div"),d=document.createElement("input"),e=document.createElement("label"),c.className="form-label-group",c.id="data",d.type="text",d.id="previewUrl",d.className="form-control",d.placeholder="Preview image url",d.required=!0,getParameterByName("previewUrl")&&(d.value=getParameterByName("previewUrl")),e.htmlFor="previewUrl",e.innerHTML="預覽網址",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4])):"audio"==a?(c.className="form-label-group",c.id="data",d.type="text",d.id="downloadUrl",d.className="form-control",d.placeholder="Original content url",d.required=!0,getParameterByName("downloadUrl")&&(d.value=getParameterByName("downloadUrl")),e.htmlFor="downloadUrl",e.innerHTML="下載網址",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4])):"messages"==a?(c.className="form-label-group",c.id="data",f.id="messages",f.className="form-control",f.placeholder="Messages json",f.rows="5",getParameterByName("messages")&&(f.value=getParameterByName("messages")),c.appendChild(f),g.insertBefore(c,g.childNodes[4])):"messagesUrl"==a?(c.className="form-label-group",c.id="data",d.type="text",d.id="messagesUrl",d.className="form-control",d.placeholder="Messages json url",d.required=!0,getParameterByName("messagesUrl")&&(d.value=getParameterByName("messagesUrl")),e.htmlFor="messagesUrl",e.innerHTML="Messages json url",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4])):"scanQr"==a?(c.className="form-label-group",c.id="data",d.type="text",d.id="qrResult",d.className="form-control",d.placeholder="QR Code Result",d.required=!0,e.htmlFor="qrResult",e.innerHTML="掃描結果",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4]),scanCodeQr()):"liffToken"==a?(c.className="form-label-group",c.id="data",d.type="text",d.id="liffToken",d.className="form-control",d.placeholder="Liff Auth Token",d.required=!0,e.htmlFor="liffToken",e.innerHTML="LIFF token",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4]),b&&getLiffToken()):"genToken"==a&&(c.className="form-label-group",c.id="data",d.type="text",d.id="lineAuthKey",d.className="form-control",d.placeholder="Line Auth Key",d.required=!0,getParameterByName("lineAuthKey")&&(d.value=getParameterByName("lineAuthKey")),e.htmlFor="lineAuthKey",e.innerHTML="驗證密鑰",c.appendChild(d),c.appendChild(e),g.insertBefore(c,g.childNodes[4]))}function sendLiffMessage(){var a=document.getElementById("type").value,b=new HttpClient,c="Unknown",d="https://i.imgur.com/6DmTQk6.png",e="";if(liff.getProfile().then(a=>{c=a.displayName,d=a.pictureUrl,e=a.statusMessage}).catch(a=>{console.error("Error while get profile",a)}),"profile"==a)sendMessages([{type:"flex",altText:"Profile "+c,contents:{type:"bubble",hero:{type:"image",url:d,size:"full",aspectRatio:"1:1",aspectMode:"cover",action:{type:"uri",uri:"line://app/2002197923-oyY6wJ68?auto=yes&type=image&downloadUrl="+d+"&previewUrl="+d}},body:{type:"box",layout:"vertical",contents:[{type:"text",text:c,align:"center",weight:"bold",size:"xl"},{type:"box",layout:"vertical",margin:"lg",spacing:"sm",contents:[{type:"text",text:e,wrap:!0,color:"#666666",size:"sm",maxLines:5,flex:5}]}]},footer:{type:"box",layout:"horizontal",spacing:"sm",contents:[{type:"button",style:"primary",height:"sm",color:"#02afff",action:{type:"uri",label:"Open Chat",uri:"https://line.me/ti/g2/JGUODBE4RE"}},{type:"button",style:"primary",height:"sm",action:{type:"uri",label:"Profile",uri:"line://app/2002197923-oyY6wJ68?auto=yes&type=profile"}},{type:"spacer",size:"sm"}]}}}]);else if("text"==a)sendMessages([{type:"text",text:document.getElementById("text").value}]);else if("sticker"==a)sendMessages([{type:"sticker",packageId:document.getElementById("packageId").value,stickerId:document.getElementById("stickerId").value}]);else if("stickerimage"==a)stickerId=document.getElementById("stickerId").value,packageId=document.getElementById("packageId").value,animation=document.getElementById("animation").checked,imageUrl=!0==animation?"https://stickershop.line-scdn.net/stickershop/v1/sticker/"+stickerId+"/IOS/sticker_animation@2x.png":"https://stickershop.line-scdn.net/stickershop/v1/sticker/"+stickerId+"/IOS/sticker@2x.png",sendMessages([{type:"template",altText:c+" sent a sticker.",template:{type:"image_carousel",columns:[{imageUrl:imageUrl,action:{type:"uri",uri:"line://shop/sticker/detail/"+packageId}}]}}]);else if("image"==a)sendMessages([{type:"image",originalContentUrl:document.getElementById("downloadUrl").value,previewImageUrl:document.getElementById("previewUrl").value}]);else if("video"==a)sendMessages([{type:"video",originalContentUrl:document.getElementById("downloadUrl").value,previewImageUrl:document.getElementById("previewUrl").value}]);else if("audio"==a)sendMessages([{type:"audio",originalContentUrl:document.getElementById("downloadUrl").value,duration:6e4}]);else if("messages"==a)sendMessages(JSON.parse(document.getElementById("messages").value));else if("messagesUrl"==a){var f=document.getElementById("messagesUrl").value;b.get(f,function(a){sendMessages(JSON.parse(a))}).catch(a=>{console.error("Parsing messages failed",a)})}else"scanQr"==a?sendMessages([{type:"text",text:document.getElementById("qrResult").value}]):"liffToken"==a?sendMessages([{type:"text",text:document.getElementById("liffToken").value}]):"genToken"==a&&b.get("generateToken.php?lineAuthKey="+document.getElementById("lineAuthKey").value,function(a){sendMessages([{type:"text",text:a}])}).catch(a=>{console.error("Generate token failed",a)})}function sendMessages(a){liff.isInClient()?!0==document.getElementById("share").checked?(console.info("Start initializing share message"),liff.isApiAvailable("shareTargetPicker")&&liff.shareTargetPicker(a).then(()=>{console.log("Share message was launched")}).catch(a=>{console.error("Share message failed",a)})):(console.info("Start sending message"),liff.sendMessages(a).then(()=>{console.info("Success sending message"),liff.closeWindow()}).catch(a=>{console.error("Sending message failed",a)})):sendAlertIfNotInClient()}function getLiffToken(){document.getElementById("liffToken").value=liff.isLoggedIn()?liff.getAccessToken():"You must login first"}function scanCodeQr(){liff.isInClient()?(console.info("Start scan code qr"),liff.scanCode().then(a=>{document.getElementById("qrResult").value=a.value}).catch(a=>{console.error("Scan code qr failed",a)})):sendAlertIfNotInClient()}function loginLiff(){liff.isLoggedIn()||liff.login()}function logoutLiff(){liff.isLoggedIn()&&(liff.logout(),window.location.reload())}function getParameterByName(a){var b=null;return a=a.replace(/[\[\]]/g,"\\$&"),params[a]&&(b=unescape(params[a])),b}function getParameterByNameV2(a){a=a.replace(/[\[\]]/g,"\\$&");var b=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),c=b.exec(url);return c?c[2]?decodeURIComponent(c[2].replace(/\+/g," ")):"":null}function removeElements(a){for(var b=document.getElementsByClassName(a),c=b.length-1;0<=c;c--)b[c]&&b[c].parentElement&&b[c].id&&"data"==b[c].id&&b[c].parentElement.removeChild(b[c])}function sendAlertIfNotInClient(){alert("此按鈕不可用，LIFF在瀏覽器外部中打開（請在LINE中使用）")}